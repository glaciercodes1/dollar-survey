<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DOLLAR SURVEY</title>
  <link rel="stylesheet" href="homepage-style.css" />
</head>

<body>
  <a href="balance.html" class="referral-banner">
    invite your friends to increase your earnings!
  </a>


</head>

<body>
    <div class="user-info">
  <div id="user-email">User: ...</div>
  <div id="user-balance">Balance: $0.00</div>
</div>

    <div class="hamburger" onclick="toggleMenu()">
  <span></span>
  <span></span>
  <span></span>
</div>


  <header>
    <div class="menu-container">
  
  <div id="menu-dropdown" class="menu-dropdown">
    <a href="profile.html">profile</a>
    <a href="balance.html">Refer</a>
    <a href="withdraw.html">Withdraw</a>
    <a href="about.html">About</a>
    <a href="login.html">Logout</a>
  </div>
</div>


    <div id="title"><h1>DOLLAR SURVEY</h1></div>
    <div class="logo-container">
  <img src="images/a6ee2559-b2a4-46be-a0ca-e71a28189c82.png" alt="Dollar Survey Logo" class="logo-image" />
</div>

    
    <div id="subtitle"><h2>Welcome to Dollar Survey</h2></div>


    </div>
    

  </header>
  <div class="referral-section">
  <span id="referral-link">https://dollarsurvey.netlify</span>
  <button onclick="shareReferral()">Share Link</button>
  
</div>

</div>

<script>
function shareReferral() {
  const referralUrl = document.getElementById('referral-link').textContent;

  if (navigator.share) {
    navigator.share({
      title: 'Join Dollar Survey',
      text: 'Sign up using my referral link and earn money from surveys:',
      url: referralUrl
    }).catch((err) => {
      console.error('Share failed:', err);
      fallbackCopy(referralUrl);
    });
  } else {
    fallbackCopy(referralUrl);
  }
}

function fallbackCopy(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert("Referral link copied to clipboard!");
  }).catch(err => {
    console.error('Clipboard copy failed:', err);
    alert("Failed to copy link. Please copy it manually.");
  });
}

  function toggleMenu() {
    var menu = document.getElementById("menu-dropdown");
    menu.classList.toggle("show");
  }
</script>
<div>
  <p class="survey-question">1. What do you think about Dollar Survey?</p>
  <input type="text" class="survey-answer" placeholder="required" />

  <p class="survey-question">2. How did you hear about us?</p>
  <input type="text" class="survey-answer" placeholder="required" />

  <p class="survey-question">3. Would you recommend us to others?</p>
  <input type="text" class="survey-answer" placeholder="required" />
<br><br>
  <button onclick="submitFullSurvey()">Submit Survey</button>
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getFirestore, collection, addDoc, doc, setDoc, getDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDnq2364tMuRPbrjjHmUfFUTjWZC2BmIS4",
    authDomain: "dollar-survey-60fe7.firebaseapp.com",
    projectId: "dollar-survey-60fe7",
    storageBucket: "dollar-survey-60fe7.appspot.com",
    messagingSenderId: "293471697208",
    appId: "1:293471697208:web:664863f09e830e420c69cd"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  let userCountry = "Unknown";

  fetch("https://ipapi.co/json")
    .then(res => res.json())
    .then(data => {
      userCountry = data.country_name || "Unknown";
    });

  // Show user info live
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      document.getElementById("user-email").textContent = `User: ${user.email || 'Anonymous'}`;
      const userRef = doc(db, "users", user.uid);
      const userSnap = await getDoc(userRef);
      const balance = userSnap.exists() ? userSnap.data().balance || 0 : 0;
      document.getElementById("user-balance").textContent = `Balance: $${balance.toFixed(2)}`;
    }
  });

  // Survey submission
  window.submitFullSurvey = async function () {
    const answerEls = document.querySelectorAll(".survey-answer");
    const questionEls = document.querySelectorAll(".survey-question");

    const allAnswered = Array.from(answerEls).every(el => el.value.trim() !== "");
    if (!allAnswered) {
      alert("Please answer all questions before submitting.");
      return;
    }

    const responses = {};
    questionEls.forEach((qEl, idx) => {
      responses[qEl.innerText] = answerEls[idx].value.trim();
    });

    const user = auth.currentUser;
    const uid = user?.uid || "anonymous";
    const email = user?.email || "anonymous@user.com";

    try {
      // Save survey response
      await addDoc(collection(db, "submittedSurveys"), {
        userId: uid,
        email: email,
        responses: responses,
        country: userCountry,
        timestamp: serverTimestamp()
      });

      // Update balance
      const userRef = doc(db, "users", uid);
      const userSnap = await getDoc(userRef);
      const currentBalance = userSnap.exists() ? userSnap.data().balance || 0 : 0;
      const newBalance = currentBalance + 0.5;

      await setDoc(userRef, { balance: newBalance }, { merge: true });

      document.getElementById("user-balance").textContent = `Balance: $${newBalance.toFixed(2)}`;

      alert("Survey submitted. Balance updated!");
      answerEls.forEach(el => el.value = "");

    } catch (err) {
      console.error("Error:", err);
      alert("Survey submission failed.");
    }
  };
</script>


</body>

</html>
